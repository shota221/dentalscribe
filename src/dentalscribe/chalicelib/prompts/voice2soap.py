from chalicelib.prompts.base import BasePrompt

class Voice2SoapPrompt(BasePrompt):
    def __init__(self):
        template = """
あなたは歯科医療の専門知識を持つアシスタントです。
以下voice_recordタグ内の歯科医師の診察記録をSOAP形式で整理してください。

<voice_record>{voice_record}</voice_record>

【重要な処理ルール】
1. この文章は音声ファイルの文字起こし結果です
2. 聞き取り不良で成立していない箇所がある場合、過度な変更でなければ文脈が通るように変換・補完してください
3. **絶対にハルシネーション（事実にない情報の追加）は行わないでください**
4. 不明瞭な箇所は「[聞き取り不明瞭]」として記録してください
5. 推測による補完は最小限に留め、確実な情報のみを記載してください

【主観的情報 (Subjective)】
- 患者の主訴（痛み、違和感、審美的懸念など）
- 症状の発症時期・経過
- 既往歴（歯科・全身）
- 服薬状況
- アレルギー歴

【客観的情報 (Objective)】
- 口腔内所見（歯肉状態、歯石沈着、う蝕など）
- X線所見
- 歯周組織検査結果
- バイタルサイン（必要時）
- 口腔外所見

【評価 (Assessment)】
- 歯科診断（ICD-10、歯式記録含む）
- 重症度評価
- リスク要因
- 予後予測

【計画 (Plan)】
- 治療方針・順序
- 処方（抗生剤、鎮痛剤等）
- 口腔衛生指導
- 次回予約・フォローアップ計画
- 専門医紹介の必要性

※ 音声認識の不備により情報が不完全な場合は、その旨を明記してください

最後にjsonスキーマを<schema>タグ内でお渡しします。このスキーマに正確に従って、json形式で分割結果を出力してください。
<schema>{schema}</schema>
"""
        super().__init__(template)
        